<?xml version="1.0" encoding="UTF-8" ?>
<project name="Template - BootstrapBase" default="">
    <property file="build.properties"/>
    <property name="path.build" value="${src}/build"/>
    <property name="path.languages" value="${path.joomla}/language"/>

    <target name="deploy" description="Deploy template code to a pre-existing Joomla site.">
        <delete dir="${path.joomla}/templates/bootstrapbase" includeemptydirs="true" failonerror="true"/>

        <copy todir="${path.joomla}/templates/bootstrapbase">
            <fileset dir="${src}/templates/bootstrapbase" defaultexcludes="false">
                <exclude name="language"/>
            </fileset>
        </copy>

        <copy todir="${path.joomla}">
            <fileset dir="${src}/templates/bootstrapbase" defaultexcludes="true">
                <include name="language/**"/>
            </fileset>
        </copy>

        <phingcall target="deploy_plugin"/>
    </target>

    <target name="clean" description="Cleans the build path.">
        <delete dir="${path.build}"/>
    </target>

    <target name="package" description="Create an installable package." depends="clean">
        <mkdir dir="${path.build}"/>

        <copy todir="${path.build}" overwrite="true">
            <fileset dir="./templates/bootstrapbase" defaultexcludes="false">
                <exclude name="build/**"/>
                <exclude name="build*.xml"/>
                <exclude name="build.properties*"/>
            </fileset>
        </copy>

        <foreach list="${overrides.exclude}" param="exclude" target="remove_override"/>

        <zip destfile="${path.build}/tpl_bootstrapbase.zip" basedir="${path.build}"/>

        <phingcall target="package_plugin"/>

        <delete includeemptydirs="true">
            <fileset dir="${path.build}" includes="**/**">
                <exclude name="*.zip"/>
            </fileset>
        </delete>
    </target>

    <target name="deploy_plugin" hidden="true">
        <copy
            todir="${path.joomla}/plugins/system/jscss">
            <fileset dir="${src}/plg_system_jscss">
                <include name="**/**"/>
                <exclude name="language/**"/>
            </fileset>
        </copy>

        <copy
            todir="${path.build}/plugins/plg_system_jscss">
            <fileset dir="${src}/plg_system_jscss">
                <include name="**/**"/>
            </fileset>
        </copy>

        <mkdir dir="${path.build}/plugins/plg_system_jscss"/>

        <composer command="install" composer="${composer.phar}">
            <arg value="--optimize-autoloader"/>
            <arg value="--working-dir"/>
            <arg path="${path.build}/plugins/plg_system_jscss"/>
        </composer>

        <copy todir="${path.joomla}/plugins/system/jscss">
            <fileset dir="${path.build}/plugins/plg_system_jscss">
                <include name="**/**"/>
                <exclude name="language/**"/>
            </fileset>
        </copy>

        <copy todir="${path.languages}">
            <fileset dir="${path.build}/plugins/plg_system_jscss/language">
                <include name="**/**"/>
            </fileset>
        </copy>
    </target>

    <target name="package_plugin" hidden="true">
        <copy
            todir="${path.joomla}/plugins/system/jscss">
            <fileset dir="${src}/plg_system_jscss">
                <include name="**/**"/>
                <exclude name="language/**"/>
            </fileset>
        </copy>

        <copy
            todir="${path.build}/plugins/plg_system_jscss">
            <fileset dir="${src}/plg_system_jscss">
                <include name="**/**"/>
            </fileset>
        </copy>

        <mkdir dir="${path.build}/plugins/plg_system_jscss"/>

        <composer command="install" composer="${composer.phar}">
            <arg value="--optimize-autoloader"/>
            <arg value="--working-dir"/>
            <arg path="${path.build}/plugins/plg_system_jscss"/>
        </composer>

        <zip destfile="${path.build}/plg_system_jscss.zip" basedir="${path.build}/plugins/plg_system_jscss/"/>
    </target>

    <target name="help" description="Prints this help.">
        <exec command="phing -f ${phing.file} -l" outputProperty="phing_targets"/>
        <echo msg="Call phing with the following targets:"/>
        <echo>${phing_targets}</echo>
    </target>

    <target name="remove_override">
        <delete dir="${path.build}/html/${exclude}"/>
    </target>
</project>
